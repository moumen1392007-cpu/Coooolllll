<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
body{font-family:'Tajawal',sans-serif}
</style>
</head>
<body class="bg-gray-100 p-4">
<div class="max-w-2xl mx-auto bg-white rounded-xl shadow p-6">
<h1 class="text-2xl font-bold text-center text-blue-600 mb-6">ğŸ¤– Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ</h1><!-- Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª --><div id="upload">
  <div class="border-2 border-dashed rounded-lg p-6 text-center bg-blue-50">
    <input type="file" id="files" multiple accept=".pdf,.png,.jpg" class="hidden" />
    <label for="files" class="cursor-pointer text-blue-600">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ PDF Ø£Ùˆ ØµÙˆØ±Ø©</label>
    <div id="count" class="text-sm text-gray-500 mt-2"></div>
  </div><label class="block mt-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</label> <input id="qcount" type="number" value="5" min="1" class="w-full border rounded p-2" />

<button id="start" class="w-full mt-4 bg-blue-600 text-white py-3 rounded">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>

</div><!-- Ø§Ù„ØªØ­Ù…ÙŠÙ„ --><div id="loading" class="hidden text-center py-8">
  <p id="status" class="text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
</div><!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© --><div id="quiz" class="hidden">
  <div class="flex justify-between text-sm mb-3">
    <span>Ø³Ø¤Ø§Ù„ <span id="idx">1</span></span>
    <span>Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="score">0</span></span>
  </div>
  <h3 id="qtext" class="font-bold mb-4"></h3>
  <div id="opts" class="space-y-2"></div>
  <div id="exp" class="hidden mt-4 p-3 bg-blue-50 border-r-4 border-blue-600"></div>
  <button id="next" class="hidden w-full mt-4 bg-green-600 text-white py-2 rounded">Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>
</div><script>
// Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙŠØ¹Ù…Ù„ 100% Ø¹Ù„Ù‰ GitHub Pages Ø¨Ø¯ÙˆÙ† Ø£ÙŠ API Ø®Ø§Ø±Ø¬ÙŠ

const filesInput = document.getElementById('files');
const startBtn = document.getElementById('start');
const upload = document.getElementById('upload');
const loading = document.getElementById('loading');
const quiz = document.getElementById('quiz');
const countEl = document.getElementById('count');
const statusEl = document.getElementById('status');
const qcountInput = document.getElementById('qcount');
const idxEl = document.getElementById('idx');
const scoreEl = document.getElementById('score');
const qtextEl = document.getElementById('qtext');
const optsEl = document.getElementById('opts');
const expEl = document.getElementById('exp');
const nextBtn = document.getElementById('next');

let files = [];
let questions = [];
let current = 0;
let score = 0;

pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

filesInput.onchange = e => {
  files = Array.from(e.target.files);
  countEl.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${files.length} Ù…Ù„ÙØ§Øª`;
};

startBtn.onclick = async () => {
  if (!files.length) return alert('Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ø§Ù‹');

  upload.classList.add('hidden');
  loading.classList.remove('hidden');

  let text = '';

  for (const f of files) {
    statusEl.textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† ${f.name}`;
    if (f.type === 'application/pdf') {
      const pdf = await pdfjsLib.getDocument(await f.arrayBuffer()).promise;
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const c = await page.getTextContent();
        text += c.items.map(x => x.str).join(' ') + ' ';
      }
    } else {
      const r = await Tesseract.recognize(f, 'ara');
      text += r.data.text + ' ';
    }
  }

  statusEl.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ Ø¨Ø°ÙƒØ§Ø¡...';

  questions = generateSmartQuestions(text, parseInt(qcountInput.value));

  loading.classList.add('hidden');
  quiz.classList.remove('hidden');
  showQuestion();
};

function generateSmartQuestions(text, count) {
  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ
  const sentences = text.split(/[\.ØŸ!]/).map(s => s.trim()).filter(s => s.length > 20);

  const qs = [];

  for (let i = 0; i < Math.min(count, sentences.length); i++) {
    const s = sentences[i];
    const words = s.split(' ').filter(w => w.length > 3);
    if (words.length < 4) continue;

    const answer = words[Math.floor(words.length / 2)];
    const options = shuffle([
      answer,
      words[0],
      words[words.length - 1],
      words[Math.floor(words.length / 3)]
    ]);

    qs.push({
      question: `Ù…Ø§ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø¹Ù†Ù‰ ÙÙŠ Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ\n"${s.replace(answer, '____')}"`,
      options,
      answer: options.indexOf(answer),
      explanation: `Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${answer}`
    });
  }

  return qs;
}

function showQuestion() {
  const q = questions[current];
  idxEl.textContent = current + 1;
  qtextEl.textContent = q.question;
  optsEl.innerHTML = '';
  expEl.classList.add('hidden');
  nextBtn.classList.add('hidden');

  q.options.forEach((opt, i) => {
    const b = document.createElement('button');
    b.className = 'w-full border p-3 rounded';
    b.textContent = opt;
    b.onclick = () => {
      [...optsEl.children].forEach(x => x.disabled = true);
      if (i === q.answer) {
        b.classList.add('bg-green-100');
        score++;
        scoreEl.textContent = score;
      } else {
        b.classList.add('bg-red-100');
        optsEl.children[q.answer].classList.add('bg-green-100');
      }
      expEl.textContent = q.explanation;
      expEl.classList.remove('hidden');
      nextBtn.classList.remove('hidden');
    };
    optsEl.appendChild(b);
  });
}

nextBtn.onclick = () => {
  current++;
  if (current < questions.length) showQuestion();
  else alert(`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±! Ù†ØªÙŠØ¬ØªÙƒ: ${score}/${questions.length}`);
};

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
</script></body>
</html>
